!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.rws=e()}}(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){var WebSocket=require("./WebSocket");function ReconnectingWebSocket(url,options){var me=this;this.id=options&&options.id||randomUUID();this.url=url+"/?id="+this.id;this.socket=null;this.opened=false;this.closed=false;this.options={reconnectTimeout:Infinity,reconnectInterval:5e3};if(options){if("reconnectTimeout"in options)this.options.reconnectTimeout=options.reconnectTimeout;if("reconnectInterval"in options)this.options.reconnectInterval=options.reconnectInterval}this.queue=[];this.attempts=0;this.reconnectTimer=null;function connect(){me.socket=new WebSocket(me.url);me.socket.onmessage=function(event){me.onmessage(event)};me.socket.onerror=function(error){if(me.socket.readyState===WebSocket.OPEN){me.onerror(error)}else{reconnect()}};me.socket.onopen=function(event){me.attempts=0;if(!me.opened){me.onopen(event);me.opened=true}else{me.onreconnect(event)}console.log("flush messages "+me.queue);while(me.queue.length>0){var data=me.queue.shift();me.socket.send(data)}};me.socket.onclose=function(event){if(me.closed){me.onclose(event)}else{reconnect()}}}function reconnect(){if(me.reconnectTimer){return}me.attempts++;if(me.attempts<me.options.reconnectTimeout/me.options.reconnectInterval){me.reconnectTimer=setTimeout(function(){me.reconnectTimer=null;connect()},me.options.reconnectInterval)}else{me.close()}}connect()}ReconnectingWebSocket.prototype.onopen=function(event){};ReconnectingWebSocket.prototype.onreconnect=function(event){};ReconnectingWebSocket.prototype.onclose=function(event){};ReconnectingWebSocket.prototype.onerror=function(error){};ReconnectingWebSocket.prototype.onmessage=function(event){};ReconnectingWebSocket.prototype.send=function(data){if(this.socket.readyState===WebSocket.OPEN){this.socket.send(data)}else if(this.closed){throw new Error("Socket is closed")}else{this.queue.push(data);console.log("queue message "+data)}};ReconnectingWebSocket.prototype.close=function(){this.closed=true;this.opened=false;this.socket.close()};function randomUUID(){var S4=function(){return Math.floor(Math.random()*65536).toString(16)};return S4()+S4()+"-"+S4()+"-"+S4()+"-"+S4()+"-"+S4()+S4()+S4()}module.exports=ReconnectingWebSocket},{"./WebSocket":2}],2:[function(require,module,exports){if(typeof window!=="undefined"){if(window.WebSocket){module.exports=window.WebSocket}else{throw new Error("Your browser doesn't support WebSocket")}}else{module.exports=require("ws")}},{ws:undefined}],3:[function(require,module,exports){exports.ReconnectingWebSocket=require("./ReconnectingWebSocket")},{"./ReconnectingWebSocket":1}]},{},[3])(3)});